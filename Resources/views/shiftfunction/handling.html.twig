<script>
function grabShiftFunctionList(shift_id) {
    url = "{{ path('shiftfunction_index', {'access': 'ajax' }) }}" 
        + "?shift=" + shift_id;
    $.get(url, function( data ) {
        $( "#sfTable_" + shift_id ).html(data);
        $( "#sfList_" + shift_id ).show();
    }).done(function() {
        $( ".jobList" ).each(function() {
            $(this).hide();
        });
    });
    return false;
}

function hideShiftFunctionList(shift_id) {
    $( "#sfList_" + shift_id ).hide();
    return false;
}

function deleteShiftFunction(shiftfunction_id, shift_id) {
    url = "{{ path('shiftfunction_delete', { 'access': 'ajax', 'id': 'XXX' }) }}";
    url = url.replace("XXX", shiftfunction_id);
    data = { _method: "delete"};
    data = data.serialize;
    $.ajax({
        beforeSend: function(req) {
          req.setRequestHeader("Accept", "application/json");
        },
        url: url,
        type: "DELETE",
        data: data,
        dataType: "text",
        async: true,
      }).done( function( cont, textStatus, xhr ) {
            if (xhr.status == 200) {
                grabShiftFunctionList(shift_id);
            } else {
                $( "#newShiftFunction_"+shift_id ).html(xhr.responseText);
            }
      }).fail(function(xhr, status, error) {
            errmsg = "Message sending failed\n";
            errmsg = errmsg + xhr.responseText + "\n";
            alert(errmsg);
    });
    return false;
}

function submitNewShiftFunctionForm(shift_id) {
    $.ajax({
        beforeSend: function(req) {
          req.setRequestHeader("Accept", "application/json");
        },
        type: "POST",
        url: "{{ path('shiftfunction_new', { 'access': 'ajax' }) }}",
        data: $( "#newShiftFunctionForm" ).serialize(),
        dataType: "text",
        async: true,
      }).done( function( cont, textStatus, xhr ) {
            if (xhr.status == 201) {
                $( "#newShiftFunction_"+shift_id ).html('');
                grabShiftFunctionList(shift_id);
            } else {
                $( "#newShiftFunction_"+shift_id ).html(xhr.responseText);
            }
      }).fail(function(xhr, status, error) {
            errmsg = "Message sending failed\n";
            errmsg = errmsg + xhr.responseText + "\n";
            alert(errmsg);
    });
    return false;
}

function grabNewShiftFunctionForm(shift_id) {
    url = "{{ path('shiftfunction_new', { 'access': 'ajax' }) }}";
    if (shift_id) {
        url = url + "?shift=" + shift_id;
    }
    $.get(url, function( data ) {
        $( "#newShiftFunction_"+shift_id ).html(data);
        $('label[for="crewcallbundle_shiftfunction_shift"]').hide();
        $( "#crewcallbundle_shiftfunction_shift" ).prev().hide();
        $( "#crewcallbundle_shiftfunction_shift" ).hide();
        $( "#newShiftFunction_"+shift_id ).submit(function( event ) {
            event.preventDefault();
            submitNewShiftFunctionForm(shift_id);
        });
    });
    return false;
}

function submitEditShiftFunctionForm(shiftfunction_id) {
    orgurl = "{{ path('shiftfunction_edit', { 'access': 'ajax' }) }}";
    url = orgurl.replace("0", shiftfunction_id);
    $.ajax({
        beforeSend: function(req) {
          req.setRequestHeader("Accept", "application/json");
        },
        type: "POST",
        url: url,
        data: $( "#editShiftFunctionForm" ).serialize(),
        dataType: "text",
        async: true,
      }).done( function( cont, textStatus, xhr ) {
        $( "#editShiftFunction_"+shiftfunction_id ).html("");
        grabShiftFunctionList(shiftfunction_id);
      }).fail(function(xhr, status, error) {
            errmsg = "Message sending failed\n";
            errmsg = errmsg + xhr.responseText + "\n";
            alert(errmsg);
    });
    return false;
}

function grabEditShiftFunctionForm(shiftfunction_id) {
    orgurl = "{{ path('shiftfunction_edit', { 'access': 'ajax' }) }}";
    url = orgurl.replace("0", shiftfunction_id);
    $.get(url, function( data ) {
        $( "#editShiftFunction_"+shiftfunction_id ).html(data);
        $( "#editShiftFunctionForm" ).submit(function( event ) {
            event.preventDefault();
            submitEditShiftFunctionForm(shiftfunction_id);
        });
    });
    return false;
}

</script>
