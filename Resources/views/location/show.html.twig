{% extends 'base.html.twig' %}

{% block body %}
{% include 'CrewCallBundle:location:handling.html.twig' %}
<div class="col-sm-3">
    <h1>{{ location }}</h1>

    <table class="showTable">
        <tbody>
            <tr>
                <th>Name</th>
                <td>{{ location.name }}</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>{{ location.description }}</td>
            </tr>
            <tr>
                <th>Phone number</th>
                <td>{{ location.phonenumber }}</td>
            </tr>
            <tr>
                <th>Address</th>
                <td>{{ cc_addressing.compose(location, 'html') | raw }}</td>
            </tr>
        </tbody>
    </table>

    <ul>
        <li>
            <a href="#" title="LOcation Summary" id="popLogSummary_location_{{ location.id }}" onClick="return popLogSummary('location', {{ location.id }});" class="btn btn-sm btn-dark">Changelog</a>
        </li>
        <li>
            <a href="{{ path('location_edit', { 'id': location.id }) }}" class="btn btn-sm btn-dark">Edit</a>
        </li>
        <li>
            {{ form_start(delete_form) }}
                <input class="btn btn-sm btn-error" type="submit" value="Delete">
            {{ form_end(delete_form) }}
        </li>
    </ul>
</div>


<div class="col-sm-9" id="eventRight">
  <ul id="tabRight" class="nav nav-tabs">
  <li class="active">
  <a href="#eventstab" data-toggle="tab">Events</a>
  </li>
  <li>
  <a href="#peopletab" data-toggle="tab">People</a>
  </li>
  <li>
  <a href="#notestab" data-toggle="tab">Notes</a>
  </li>
  <li>
  <a href="#filestab" data-toggle="tab">Files</a>
  </li>
  </ul>

<div class="tab-content">
    <div class="tab-pane active" id="eventstab">
    {% include 'CrewCallBundle:event:_index.html.twig' with { 'events': location.events('ASC'), 'sorted': true, 'past': true, 'upcoming': false, 'ongoing': false } %}
    </div>

  <div class="tab-pane" id="peopletab">
    <br>
    <div id="addExistingPerson" style="float: left">
    <p>
    <a href="#" onClick="return grabAddExistingPersonForm();" class="btn btn-sm btn-dark">Add person</a>
    </div>
    </p>

    <table id="apTable" class="table table-sm">
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Function</th>
            <th>&nbsp;</th>
        </tr>
    </thead>
    <tbody>
        {% for pfl in location.personfunctionlocations %}
        <tr>
        <td>
            <a href="{{ path('person_show', { 'id': pfl.person.id }) }}">
            {{ pfl.person }}
            </a>
        </td>
        <td>{{ pfl.person.email }}</td>
        <td>{{ pfl.person.mobilephonenumber }}</td>
        <td>{{ pfl.function }}</td>
        <td>
            <a class="btn-sm btn-danger" href="{{ path('location_remove_person', { 'id': pfl.id }) }}">Remove</a>
        </td>
        </tr>
        {% endfor %}
    </tbody>
  </table>
 </div>

    <div class="tab-pane" id="notestab">
      <br>
      {% set mconf = {'mconfig': {
              'formname': 'locationnote',
              'reload_after_post': true,
              'subject': "",
              'to_field': false,
              'from_field': false,
              'message_type': 'AdminNote',
              'context': {
                  'system': 'crewcall',
                  'object_name': 'location',
                  'external_id': location.id
                  }
              }
          }
      %}
      {% include 'BisonLabSakonninBundle:Message:_create_popup.html.twig' with mconf %}
      <p>
      <a href="#" onClick='return createMessage("locationnote");'>Add a note</a><br />
      </p>
    {% set mlogcontext = {
        'system': 'crewcall',
        'object_name': 'location',
        'message_group': 'Notes',
        'external_id': location.id
        }
    %}
    {% for note in sakonnin_messages.MessagesForContext(mlogcontext) %}
        <strong>{{ note.subject }}</strong><br>
        <pre>{{ note.body }}</pre>
        <br>
    {% endfor %}
  </div>

  <div class="tab-pane" id="filestab">
    <br>
    {% set sfconf = {'sfconfig': {
            'file_type': "AUTO",
            'reload_after_post': true,
            'context': {
                'system': 'crewcall',
                'object_name': 'location',
                'external_id': location.id
                }
            }
        }
    %}
    {% include 'BisonLabSakonninBundle:SakonninFile:_create_popup.html.twig' with sfconf %}
    <p>
      <a href="#" onClick="return uploadFile();">Add a file</a><br />
    </p>
    {% set filecontext = {
        'system': 'crewcall',
        'object_name': 'location',
        'external_id': location.id
        }
    %}
    {% include 'CrewCallBundle::_files.html.twig' with filecontext %}
  </div>
 </div>
</div>


{% endblock %}
