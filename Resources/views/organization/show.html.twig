{% extends 'base.html.twig' %}

{% block body %}
{% include 'CrewCallBundle:organization:handling.html.twig' %}
<div class="col-sm-5" id="orgLeft">
    <h1>{{ organization.name }}</h1>

    <table class="showTable">
        <tbody>
            <tr>
                <th scope="row">Id</th>
                <td>{{ organization.id }}</td>
            </tr>
            <tr>
                <th>Name</th>
                <td>{{ organization.name }}</td>
            </tr>
            <tr>
                <th>Organization number</th>
                <td>{{ organization.organizationnumber }}</td>
            </tr>
            <tr>
                <th>Office phone number</th>
                <td>{{ organization.officephonenumber }}</td>
            </tr>
            <tr>
                <th>Office email</th>
                <td>{{ organization.officeemail }}</td>
            </tr>
            <tr>
                <th>State</th>
                <td>{{ organization.state }}</td>
            </tr>
            <tr>
                <th>Attributes</th>
                <td>{{ organization.attributes | prettyprint}}</td>
            </tr>
        </tbody>
    </table>

    <ul>
        <li>
            <a href="{{ path('organization_log', { 'id': organization.id }) }}">History</a>
        </li>
        <li>
            <a href="{{ path('organization_index') }}">Back to Organizations</a>
        </li>
        <li>
            <a href="{{ path('organization_edit', { 'id': organization.id }) }}">Edit</a>
        </li>
        <li>
            {{ form_start(delete_form) }}
                <input type="submit" value="Delete">
            {{ form_end(delete_form) }}
        </li>
    </ul>
</div>

<div class="col-sm-7" id="eventRight">
  <ul class="nav nav-tabs">
{#
  <li class="active">
  <a href="#shiftstab" data-toggle="tab">Shifts</a>
  </li>
  <li>
  <a href="#caltab" data-toggle="tab">Calendar</a>
  </li>
#}
  <li class="active">
  <a href="#peopletab" data-toggle="tab">People</a>
  </li>
  <li>
  <a href="#notestab" data-toggle="tab">Notes</a>
  </li>
  <li>
  <a href="#filestab" data-toggle="tab">Files</a>
  </li>
  </ul>

  <div class="tab-content ">
    <div class="tab-pane active" id="peopletab">

<table id="apTable" class="table table-bordered table-sm">
    <thead>
        <tr>
            <th>Name</th>
            <th>Function</th>
        </tr>
    </thead>
    <tbody>
        {% for pfo in organization.personfunctionorganizations %}
        <tr>
        <td>
            <a href="{{ path('person_show', { 'id': pfo.person.id }) }}">
            {{ pfo.person }}
            </a>
        </td>
        <td>{{ pfo.function }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
    <div id="addExistingPerson" style="float: left">
    <a href="#" onClick="grabAddExistingPersonForm();">Add person</a><br>
    </div>
 </div>

    <div class="tab-pane" id="notestab">
            {% set mconf = {'mconfig': {
                    'subject': "",
                    'to_field': false,
                    'from_field': false,
                    'message_type': 'AdminNote',
                    'context': {
                        'system': 'crewcall',
                        'object_name': 'organization',
                        'external_id': organization.id
                        }
                    }
                }
            %}
            {% include 'BisonLabSakonninBundle:Message:_create_popup.html.twig' with mconf %}
            <p><br>
            <a href="#" onClick="createMessage()">Add a note</a><br />
            </p>
            {% set mlogcontext = {
                        'system': 'crewcall',
                        'object_name': 'organization',
                        'message_type': 'Notes',
                        'external_id': organization.id
                }
            %}
            {% for note in sakonnin_messages.MessagesForContext(mlogcontext) %}
                <strong>{{ note.subject }}</strong><br>
                <pre>{{ note.body }}</pre>
                <br>
            {% endfor %}
    </div>

    <div class="tab-pane" id="filestab">
        {% set sfconf = {'sfconfig': {
                'context': {
                    'system': 'crewcall',
                    'object_name': 'organization',
                    'external_id': organization.id
                    }
                }
            }
        %}
        {% include 'BisonLabSakonninBundle:SakonninFile:_create_popup.html.twig' with sfconf %}
        <p><br>
          <a href="#" onClick="uploadFile(); return false;">Add a document or image</a><br />
        </p>
        {% set filecontext = {
                    'system': 'crewcall',
                    'object_name': 'organization',
                    'external_id': organization.id
            }
        %}
        {% include 'CrewCallBundle::_files.html.twig' with filecontext %}
    </div>
  </div>
</div>

{% endblock %}
