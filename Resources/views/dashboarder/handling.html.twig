<script>
/* This must be overkill from h*/
function setStateOnMessage(message_id, state) {
    cheat_url = "{{ path('message_state', { 'id': 0, 'state': 'NONE', 'access': 'ajax' }) }}";
    c_url = cheat_url.replace("0", message_id);
    url = c_url.replace("NONE", state);
    $.ajax({
        beforeSend: function(req) {
          req.setRequestHeader("Accept", "application/json");
        },
        url: url,
        type: "POST",
        async: true,
      }).done( function( cont, textStatus, xhr ) {
            if (state == "ARCHIVED") {
                $('#sakonninmessage_' + message_id).hide();
            }
      }).fail(function(xhr, status, error) {
            errmsg = "Failed changing state\n";
            errmsg = errmsg + xhr.responseText + "\n";
            alert(errmsg);
    });
    return false;
}

/*
 * This is for notes without a subject.
 * It uses the submit and modal from sakonnin.
 */
function grabEditNoteForm(message_id, title = "Edit Note", reload_after_post = false) {
    orgurl = "{{ path('message_edit', {'id': 0, 'access': 'ajax' }) }}";
    url = orgurl.replace("0", message_id);
    $.get(url, function( data ) {
        $( "#editMessageModalBody" ).html(data);
        $( "#editMessageModalTitle" ).html(title);
        $( "#editMessageForm #message_data_state").prev().hide();
        $( "#editMessageForm #message_data_state").hide();
        $( "#editMessageForm #message_data_subject").prev().hide();
        $( "#editMessageForm #message_data_subject").hide();
        $( "#editMessageForm #message_data_expire_at").prev().hide();
        $( "#editMessageForm #message_data_expire_at").hide();

        $( "#editMessageModal" ).modal();
        $( "#editMessageForm" ).submit(function( event ) {
            event.preventDefault();
            submitEditMessageForm(message_id, reload_after_post);
        });
    });
    return false;
}

</script>
