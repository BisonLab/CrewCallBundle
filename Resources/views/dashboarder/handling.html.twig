<script>

/*
 * This is for notes without a subject.
 * It uses the submit and modal from sakonnin.
 */
function grabEditNoteForm(message_id, title = "Edit Note", reload_after_post = false) {
    orgurl = "{{ path('message_edit', {'id': 0, 'access': 'ajax' }) }}";
    url = orgurl.replace("0", message_id);
    $.get(url, function( data ) {
        $( "#editMessageModalBody" ).html(data);
        $( "#editMessageModalTitle" ).html(title);
        $( "#editMessageForm #message_data_state").prev().hide();
        $( "#editMessageForm #message_data_state").hide();
        $( "#editMessageForm #message_data_subject").prev().hide();
        $( "#editMessageForm #message_data_subject").hide();
        $( "#editMessageForm #message_data_expire_at").prev().hide();
        $( "#editMessageForm #message_data_expire_at").hide();

        $( "#editMessageModal" ).modal();
        $( "#editMessageForm" ).submit(function( event ) {
            event.preventDefault();
            submitEditMessageForm(message_id, reload_after_post);
        });
    });
    return false;
}

function addCheckReply(message_id, message_type, state) {
    message_data = { 
        'in_reply_to': message_id,
        'message_type': message_type,
        'subject': '',
        'body': '',
        'state': state
        };
    formdata = JSON.stringify({ 
            'message_data': message_data
        });
    $.ajax({
        beforeSend: function(req) {
          req.setRequestHeader("Accept", "application/json");
        },
        contentType: 'application/json',
        type: 'POST',
        url: "{{ path('message_create', { 'access': 'ajax' }) }}",
        processData: false,
        dataType: 'json',
        data: formdata,
        async: true,
      }).done( function( cont, textStatus, xhr ) {
            return false;
      }).fail(function(xhr, status, error) {
            errmsg = "Faled setting TODO\n";
            errmsg = errmsg + xhr.responseText + "\n";
            alert(errmsg);
    });
    return false;
}

function setCheckboxState(message_id, message_type, elem) {
    if (elem.checked) {
        addCheckReply(message_id, message_type, "CHECKED");
    } else {
        addCheckReply(message_id, message_type, "UNCHECKED");
    }
}

</script>
